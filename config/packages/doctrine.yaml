doctrine:
  dbal:
    # Component-based configuration to avoid IPv6 issues on Render.com
    # When DATABASE_URL is set, it will override these individual settings
    driver: 'pdo_pgsql'
    host: '%env(default::DB_HOST)%'
    port: '%env(default::DB_PORT)%'
    dbname: '%env(default::DB_NAME)%'
    user: '%env(default::DB_USER)%'
    password: '%env(default::DB_PASSWORD)%'
    server_version: '15.0'
    profiling_collect_backtrace: false
    # Use IPv4 pooler from Supabase - AWS IPv4-only endpoint
    # Check Supabase dashboard > Project Settings > Database for IPv4 pooler
    types:
      kilometer: App\Infrastructure\Doctrine\Type\KilometerType
      meter: App\Infrastructure\Doctrine\Type\MeterType
    mapping_types:
      code_challenge_method: string
      factor_type: string
      factor_status: string
      aal_level: string
      key_status: string
      key_type: string
  orm:
    enable_native_lazy_objects: true
    validate_xml_mapping: true
    naming_strategy: Linkin\Component\DoctrineNamingStrategy\ORM\Mapping\CamelCaseNamingStrategy
    identity_generation_preferences:
      Doctrine\DBAL\Platforms\PostgreSQLPlatform: identity
    auto_mapping: true
    mappings:
      App:
        type: attribute
        is_bundle: false
        dir: '%kernel.project_dir%/src'
        prefix: 'App'
        alias: App
    controller_resolver:
      auto_mapping: false

when@test:
  doctrine:
    dbal:
      # "TEST_TOKEN" is typically set by ParaTest
      dbname_suffix: '_test%env(default::TEST_TOKEN)%'
      # Use PostgreSQL for tests too (can use same Supabase with different schema/db)
      # Or create a separate test database in Supabase
